<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.customerCenter">

	<!-- 다음 QNA 글 번호 가져오기 -->
	<select id="getnextqnano" resultType="String">
		SELECT
			'Q'||YOMUL_QNA_ARTICLES_NO_SEQ.NEXTVAL AS NO 
		FROM
			DUAL
	</select>
	
	<!-- QNA 작성하기 -->
	<insert id="writeqna" parameterType="com.yomul.vo.QnaVO">
		INSERT INTO YOMUL_QNA_ARTICLES
		(
			  NO
			, NAME
			, EMAIL
			, PW
			, HASHSALT
			, CATEGORY
			, TITLE
			, CONTENT
		) 
		VALUES
		(
			  #{no}
			, #{name}
			, #{email}
			, #{pw}
			, #{hashsalt}
			, #{category}
			, #{title}
			, #{content}
		)
	</insert>
	
	<!-- QNA 목록 가져오기 -->
	<select id="getqnalist" resultType="com.yomul.vo.QnaVO">
		SELECT
			  NO
			, TITLE
			, CONTENT
			, TO_CHAR(WDATE, 'YYYY-MM-DD') AS WDATE
			, RDATE 
		FROM
		(
			SELECT
				*
			FROM 
				YOMUL_QNA_ARTICLES 
			ORDER BY 
				WDATE DESC
		)
	</select>
	
	<!-- QnA 상세보기 -->
	<select id="getqnainfo" parameterType="com.yomul.vo.QnaVO" resultType="com.yomul.vo.QnaVO">
		SELECT 
			  NO
			, NAME
			, EMAIL
			, TO_CHAR(WDATE, 'YYYY-MM-DD') WDATE
			, CATEGORY
			, TITLE
			, CONTENT
			, HITS
			, TO_CHAR(RDATE, 'YYYY-MM-DD') RDATE
			, RWRITER
			, RCONTENT
		FROM
			YOMUL_QNA_ARTICLES
		WHERE
			NO = #{no}
	</select>
	
	<!-- faq 카테고리 목록 조회 -->
	<select id="getqnacategories" resultType="com.yomul.vo.CategoryVO">
		SELECT NO, CONTENT 
		FROM YOMUL_QNA_CATEGORIES 
		ORDER BY NO
	</select>
	
	<!-- faq 카테고리 목록 조회 -->
	<select id="selectFaqCategories" resultType="com.yomul.vo.CategoryVO">
		select no, content
		from yomul_faq_categories
		order by no asc
	</select>
	
	<!-- faq 목록 조회 -->
	<select id="selectFaqList" resultType="com.yomul.vo.FaqVO">
		select category, title, content
		from yomul_faq_articles
		order by no asc
	</select>
	
	<!-- 사용자 공지사항 목록 조회 -->
	<select id="selectNoticeList" resultType="com.yomul.vo.NoticeVO">
		select substr(no, 2) as no, title, ndate
		from yomul_notices
		order by no desc
	</select>
	
	<!-- 사용자 공지사항 상세 조회 -->
	<select id="selectNoticeInfo" resultType="com.yomul.vo.NoticeVO" parameterType="java.lang.String">
		select title, content, ndate, hits
		from yomul_notices
		where no = #{no}
	</select>
	
	<!-- 공지사항 조회수 업데이트 -->
	<update id="updateNoticeHits" parameterType="java.lang.String">
		update yomul_notices
		set hits = hits + 1
		where no = #{no}
	</update>
</mapper>