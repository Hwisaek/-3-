<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.member">
	<insert id="join" parameterType="com.yomul.vo.MemberVO">
			  NO
			, EMAIL
			, PW
			, NICKNAME
			, HASHSALT
			, SUBSCRIBE
		) 
		VALUES
		(
			  'M'||YOMUL_MEMBERS_NO_SEQ.NEXTVAL
			, #{email}
			, #{pw}
			, #{nickname}
			, #{hashsalt}
			, #{subscribe}
		)
	</insert>
	
	<!-- 프로필 정보 가져오기 -->
	<select id="getmyprofileinfo" parameterType="com.yomul.vo.MemberVO" resultType="com.yomul.vo.MemberVO">
			, NICKNAME
			, PHONE
			, GENDER
			, INTRO
		FROM 
			YOMUL_MEMBERS
		WHERE
			NO = #{no}
	</select>
	
	<!-- 프로필 사진 가져오기 -->
	<select id="getmyprofileimg" parameterType="com.yomul.vo.MemberVO" resultType="string">
		SELECT 
			ARTICLE_NO || '_' || NO || '_' || FILENAME 
		FROM 
			YOMUL_FILES 
		WHERE 
			ARTICLE_NO = #{no}
	</select>
	
	<insert id="setmyprofileinfo" parameterType="com.yomul.vo.MemberVO">
		UPDATE YOMUL_MEMBERS SET NICKNAME = #{nickname}, PHONE = #{phone}, GENDER = #{gender}, INTRO = #{intro} WHERE NO = #{no}
	</insert>
	
	<select id="getbuycount" parameterType="com.yomul.vo.MemberVO" resultType="int">
		SELECT COUNT(*) 
		FROM YOMUL_TRADE_HISTORY 
		WHERE BUYER = #{no}
	</select>
	
	<select id="getsellcount" parameterType="com.yomul.vo.MemberVO" resultType="int">
		SELECT COUNT(*) 
		FROM YOMUL_TRADE_HISTORY
		 WHERE SELLER = #{no}
	</select>
	
	<select id="getfavoritecount" parameterType="com.yomul.vo.MemberVO" resultType="int">
		SELECT COUNT(*) 
		FROM YOMUL_FAVORITE_LISTS 
		WHERE MEMBER_NO = #{no}
	</select>
	
	<select id="emailcheck" parameterType="string" resultType="int">
		SELECT COUNT(EMAIL) 
		FROM YOMUL_MEMBERS 
		WHERE LOWER(EMAIL) = LOWER(#{email})
	</select>
	
	<select id="nicknamecheck" parameterType="string" resultType="int">
		SELECT COUNT(NICKNAME) 
		FROM YOMUL_MEMBERS 
		WHERE LOWER(NICKNAME) = LOWER(#{nickname})
	</select>
</mapper>