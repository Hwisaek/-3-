<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.comment">
	
	<!-- 댓글 목록 조회 -->
	<select id="selectCommentList" resultType="com.yomul.vo.CommentVO" parameterType="java.util.HashMap">
		select writer, content, wdate, likes, img
		from (select rownum as rno, writer, content, wdate, likes, img
			from (select m.nickname as writer, c.content, c.wdate, c.likes, f.article_no||'_'||f.no||'_'||f.filename as img
				from yomul_comments c, yomul_members m, yomul_files f
				where c.article_no = #{no} and c.writer = m.no and m.no = f.article_no(+)
				order by c.no desc)
			where <![CDATA[rownum <= #{perPage} * #{page}]]>)
		where <![CDATA[rno > #{perPage} * (#{page} - 1)]]>
	</select>
	
	<!-- 댓글 갯수 확인 -->
	<select id="selectCommentCount" resultType="java.lang.Integer" parameterType="java.lang.String">
		select count(*)
		from yomul_comments
		where article_no = #{no}
		group by article_no
	</select>
</mapper>