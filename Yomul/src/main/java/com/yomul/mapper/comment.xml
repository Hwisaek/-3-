<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.comment">
	
	<!-- 댓글 목록 조회 -->
	<select id="selectCommentList" resultType="com.yomul.vo.CommentVO" parameterType="java.util.HashMap">
		select writer, content, wdate, likes, img
		from (select rownum as rno, writer, content, wdate, likes, img
			from (select m.nickname as writer, c.content, c.wdate, c.likes, c.img
				from v_y_comments c, yomul_members m
				where c.article_no = #{no} and c.writer = m.no
				order by c.no desc)
			where <![CDATA[rownum <= #{perPage} * #{page}]]>)
		where <![CDATA[rno > #{perPage} * (#{page} - 1)]]>
	</select>
	
	<!-- 댓글 갯수 확인 -->
	<select id="selectCommentCount" resultType="java.lang.Integer" parameterType="java.lang.String">
		select count(*)
		from yomul_comments
		where article_no = #{no}
		group by article_no
	</select>
	
	<!-- 댓글 등록 -->
	<insert id="insertComment" parameterType="com.yomul.vo.CommentVO">
		insert into yomul_comments(no, article_no, writer, content, wdate)
		values('C'||yomul_comment_no_seq.nextval, ${articleNo}, ${writer}, ${content}, sysdate)
	</insert>
</mapper>